<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OiPet - Teste de Exporta√ß√£o</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 32px;
        }
        
        .test-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        button {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pdf-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .excel-btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .both-btn {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #333;
            grid-column: 1 / -1;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
            color: white;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #4ade80;
        }
        
        .error {
            color: #f87171;
        }
        
        .info {
            color: #60a5fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêæ OiPet - Teste de Exporta√ß√£o</h1>
        
        <div class="test-buttons">
            <button class="pdf-btn" onclick="testPDF()">
                üìÑ Testar PDF
            </button>
            <button class="excel-btn" onclick="testExcel()">
                üìä Testar Excel
            </button>
            <button class="both-btn" onclick="testBoth()">
                üöÄ Testar Ambos
            </button>
        </div>
        
        <div class="status" id="status">
            <div class="info">‚ú® Pronto para testar as exporta√ß√µes!</div>
            <div class="info">üí° Abra o Console (F12) para logs detalhados</div>
        </div>
    </div>

    <!-- Scripts das bibliotecas via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        function log(message, type = 'info') {
            const status = document.getElementById('status');
            const now = new Date().toLocaleTimeString();
            const classes = {
                info: 'info',
                success: 'success',
                error: 'error'
            };
            
            const div = document.createElement('div');
            div.className = classes[type];
            div.textContent = `[${now}] ${message}`;
            status.appendChild(div);
            status.scrollTop = status.scrollHeight;
            
            console.log(`[OiPet Export Test] ${message}`);
        }

        async function testPDF() {
            try {
                log('üîç Iniciando teste de PDF...', 'info');
                
                // Verificar se jsPDF est√° dispon√≠vel
                if (typeof window.jsPDF === 'undefined') {
                    throw new Error('jsPDF n√£o est√° carregado');
                }
                
                log('‚úÖ jsPDF detectado', 'success');
                
                // Criar documento
                const doc = new window.jsPDF.jsPDF();
                log('‚úÖ Documento PDF criado', 'success');
                
                // Adicionar conte√∫do
                doc.setFontSize(20);
                doc.setTextColor('#E85A5A');
                doc.text('OiPet Sa√∫de - Relat√≥rio de Teste', 20, 30);
                
                doc.setFontSize(12);
                doc.setTextColor('#374151');
                doc.text('Este √© um teste de gera√ß√£o de PDF', 20, 50);
                doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 20, 70);
                doc.text(`Hora: ${new Date().toLocaleTimeString('pt-BR')}`, 20, 90);
                
                // Adicionar informa√ß√µes do pet (mock)
                doc.text('Informa√ß√µes do Pet:', 20, 120);
                doc.text('Nome: Rex', 30, 140);
                doc.text('Ra√ßa: Golden Retriever', 30, 160);
                doc.text('Peso: 15.2 kg', 30, 180);
                
                // Tentar adicionar tabela
                if (typeof doc.autoTable === 'function') {
                    log('‚úÖ AutoTable detectado', 'success');
                    
                    const tableData = [
                        ['Data', 'Atividade', 'Dura√ß√£o'],
                        ['22/07/2025', 'Caminhada', '30 min'],
                        ['21/07/2025', 'Corrida', '15 min'],
                        ['20/07/2025', 'Brincadeira', '45 min']
                    ];
                    
                    doc.autoTable({
                        head: [tableData[0]],
                        body: tableData.slice(1),
                        startY: 200,
                        theme: 'striped',
                        headStyles: {
                            fillColor: [232, 90, 90],
                            textColor: [255, 255, 255]
                        }
                    });
                    
                    log('‚úÖ Tabela adicionada ao PDF', 'success');
                } else {
                    log('‚ö†Ô∏è AutoTable n√£o dispon√≠vel', 'error');
                }
                
                // Salvar arquivo
                const fileName = `oipet-teste-${Date.now()}.pdf`;
                doc.save(fileName);
                
                log(`‚úÖ PDF "${fileName}" gerado com sucesso!`, 'success');
                log('üìÅ Verifique sua pasta de Downloads', 'success');
                
            } catch (error) {
                log(`‚ùå Erro no teste de PDF: ${error.message}`, 'error');
                console.error('Erro detalhado:', error);
            }
        }

        async function testExcel() {
            try {
                log('üîç Iniciando teste de Excel...', 'info');
                
                // Verificar se XLSX est√° dispon√≠vel
                if (typeof XLSX === 'undefined') {
                    throw new Error('XLSX n√£o est√° carregado');
                }
                
                log('‚úÖ XLSX detectado', 'success');
                
                // Criar workbook
                const workbook = XLSX.utils.book_new();
                log('‚úÖ Workbook criado', 'success');
                
                // Dados do pet (mock)
                const petData = [
                    ['OiPet Sa√∫de - Relat√≥rio de Teste'],
                    [''],
                    ['Pet', 'Rex'],
                    ['Ra√ßa', 'Golden Retriever'],
                    ['Peso', '15.2 kg'],
                    ['Data do Relat√≥rio', new Date().toLocaleDateString('pt-BR')],
                    [''],
                    ['Hist√≥rico de Atividades:'],
                    ['Data', 'Atividade', 'Dura√ß√£o', 'Calorias'],
                    ['22/07/2025', 'Caminhada', '30 min', '120'],
                    ['21/07/2025', 'Corrida', '15 min', '80'],
                    ['20/07/2025', 'Brincadeira', '45 min', '150']
                ];
                
                // Criar primeira aba
                const worksheet1 = XLSX.utils.aoa_to_sheet(petData);
                XLSX.utils.book_append_sheet(workbook, worksheet1, 'Relat√≥rio Principal');
                log('‚úÖ Primeira aba criada', 'success');
                
                // Dados de estat√≠sticas
                const statsData = [
                    ['Estat√≠sticas OiPet'],
                    [''],
                    ['Total de Atividades', '3'],
                    ['Dura√ß√£o Total', '90 min'],
                    ['Calorias Queimadas', '350'],
                    ['M√©dia de Calorias/Dia', '117'],
                    [''],
                    ['Status de Sa√∫de', 'Excelente'],
                    ['Pr√≥xima Consulta', '01/08/2025']
                ];
                
                // Criar segunda aba
                const worksheet2 = XLSX.utils.aoa_to_sheet(statsData);
                XLSX.utils.book_append_sheet(workbook, worksheet2, 'Estat√≠sticas');
                log('‚úÖ Segunda aba criada', 'success');
                
                // Salvar arquivo
                const fileName = `oipet-teste-${Date.now()}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                
                log(`‚úÖ Excel "${fileName}" gerado com sucesso!`, 'success');
                log('üìÅ Verifique sua pasta de Downloads', 'success');
                
            } catch (error) {
                log(`‚ùå Erro no teste de Excel: ${error.message}`, 'error');
                console.error('Erro detalhado:', error);
            }
        }

        async function testBoth() {
            log('üöÄ Iniciando teste completo...', 'info');
            
            await testPDF();
            
            // Pequena pausa entre os testes
            setTimeout(async () => {
                await testExcel();
                log('üéâ Teste completo finalizado!', 'success');
            }, 1000);
        }

        // Log inicial
        log('üîß Verificando bibliotecas dispon√≠veis...', 'info');
        
        setTimeout(() => {
            if (typeof window.jsPDF !== 'undefined') {
                log('‚úÖ jsPDF carregado via CDN', 'success');
            } else {
                log('‚ùå jsPDF n√£o carregado', 'error');
            }
            
            if (typeof XLSX !== 'undefined') {
                log('‚úÖ XLSX carregado via CDN', 'success');
            } else {
                log('‚ùå XLSX n√£o carregado', 'error');
            }
            
            log('üéØ Pronto para testes! Clique nos bot√µes acima.', 'success');
        }, 500);
    </script>
</body>
</html>